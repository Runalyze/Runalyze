{% extends "base_logged_in.twig" %}
{% block content %}
    <div class="panel-heading">
        <h1>{% trans %}Dataset{% endtrans %}</h1>
    </div>
    <div class="panel-content">
        <div class="panel-content">
        <fieldset id="dataset" class="">
            <legend>{% trans %}Your Dataset{% endtrans %}</legend>
            <div class="fieldset-messages">
                <p class="info">{% trans %}You can specify which values show up in the overview of your activities.<br>This does not influence the detailed activity view, the form or any plugin.{% endtrans %}</p>
            </div>
            <div>
                <table class="c fullwidth zebra-style" id="conf-tab-dataset">
        {% include 'flashmessages.html.twig' %}
        {{ form_start(form, {'attr': {'class': 'ajax no-automatic-reloads'}, 'action': url('settings-dataset') }) }}
        <table class="c fullwidth zebra-style" id="conf-tab-dataset">
            <thead>
            <tr>
                <th>&nbsp;</th>
                <th>&nbsp;</th>
                <th><span rel="tooltip" data-original-title="{% trans %}The information will be shown directly in the row.{% endtrans %}">{% trans %}Display{% endtrans %}</span></th>
                <th><span rel="tooltip" data-original-title="{% trans %}Indicates the order of appearance.{% endtrans %}">{% trans %}Order{% endtrans %}</span></th>
                <th><span rel="tooltip" data-original-title="{% trans %}any CSS-Code{% endtrans %}">{% trans %}CSS-Style{% endtrans %}</span></th>
                <th>{% trans %}Example{% endtrans %}</th>
            </tr>
            </thead>
            <tbody>

            {% for dataset in form.datasets %}
                {% set keyValues = datasetKeys.get(dataset.vars.value.keyid) %}
                <tr class="r" id="{{ dataset.vars.value.keyid }}_tr">
                    <td class="c">
                        {% if keyValues.description() %}
                            <i class="fa fa-fw fa-info-circle atRight" rel="tooltip" data-original-title="{{ keyValues.description() }}"></i>
                        {% endif %}
                    </td>
                    <td class="l b">
                        {{ keyValues.label() }}
                    </td>
                    <td class="c">
                    {{ form_widget(dataset.active) }}
                    </td>
                    <td class="c">
                        <input class="dataset-position" type="text" name="{{ dataset.vars.value.keyid }}_position" value="{{ dataset.vars.value.position }}" size="2">
                        <span class="link" onclick="datasetMove({{ dataset.vars.value.keyid }}, 'up')"><i class="fa fa-fw fa-arrow-up"></i></span>
                        <span class="link" onclick="datasetMove({{ dataset.vars.value.keyid }}, 'down')"><i class="fa fa-fw fa-arrow-down"></i></span>
                    </td>
                    <td class="c">
                        {{ form_widget(dataset.style) }}
                    </td>
                    <td class="{{ keyValues.getStyle() | raw }}"">
                        {{ keyValues.stringFor(context) | raw }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
            </table>

                    <div class="c">
                        <input type="submit" value="{% trans %}Save{% endtrans %}">
                    </div>
                    {{ form_rest(form) }}
                    {{ form_end(form) }}
            </fieldset>
        </div>
    </div>

    <script>
        function pluginMove(id, way) {
            var pos = parseInt($("input[name='plugin_order_"+id+"']").val()),
                    tr = $("#"+id+"_tr");

            if (way == "up" && pos > 1) {
                $("#"+id+"_tr .plugin-position").val(pos-1);
                tr.prev().find(".plugin-position").val(pos);
                tr.prev().toggleClass("swapped");
                tr.prev().before(tr);
            } else if (way == "down" && tr.next().find(".plugin-position").val() > 0) {
                $("#"+id+"_tr .plugin-position").val(pos+1);
                tr.next().find(".plugin-position").val(pos);
                tr.next().toggleClass("swapped");
                tr.next().after(tr);
            }

            tr.toggleClass("swapped");
        }
    </script>
{% endblock %}
