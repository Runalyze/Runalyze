<?php

if (!defined('CONF_JD_USE_VDOT_CORRECTOR'))
	define('CONF_JD_USE_VDOT_CORRECTOR', true);

require_once dirname(__FILE__) . '/../../../inc/calculate/class.JD.php';

/**
 * Test class for JD.
 * Generated by PHPUnit on 2012-04-25 at 20:14:32.
 */
class JDTest extends PHPUnit_Framework_TestCase {

	/**
	 * @covers JD::Competition2VDOT
	 */
	public function testCompetition2VDOT() {
		// VDOT: 32
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(10, 60*60 + 26), 32 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(21.0975, 60*133 + 49), 32 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(42.195, 60*274 + 59), 32 ) );
		// VDOT: 48
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(10, 60*42 + 50), 48 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(21.0975, 60*94 + 53), 48 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(42.195, 60*197 + 27), 48 ) );
		// VDOT: 60
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(10, 60*35 + 22), 60 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(21.0975, 60*78 + 9), 60 ) );
		$this->assertTrue( Validator::isClose( JD::Competition2VDOT(42.195, 60*163 + 25), 60 ) );
	}

	/**
	 * @covers JD::VDOT2v
	 */
	public function testVDOT2v() {
		// m/min
		$this->assertEquals( 300.75, JD::VDOT2v(60) );
	}

	/**
	 * @covers JD::pVDOT2pHF
	 */
	public function testPVDOT2pHF() {
		$this->assertEquals( 0.66, JD::pVDOT2pHF(0.6), '', 0.03);
		$this->assertEquals( 0.755, JD::pVDOT2pHF(0.7), '', 0.03);
		$this->assertEquals( 0.85, JD::pVDOT2pHF(0.8), '', 0.03);
		$this->assertEquals( 0.93, JD::pVDOT2pHF(0.9), '', 0.03);
		$this->assertEquals( 1, JD::pVDOT2pHF(1), '', 0.03 );
	}

	/**
	 * @covers JD::pHF2pVDOT
	 */
	public function testPHF2pVDOT() {
		$this->assertEquals( 0.64, JD::pHF2pVDOT(0.7), '', 0.03);
		$this->assertEquals( 0.75, JD::pHF2pVDOT(0.8), '', 0.03);
		$this->assertEquals( 0.86, JD::pHF2pVDOT(0.9), '', 0.03);
		$this->assertEquals( 1, JD::pHF2pVDOT(1), '', 0.03 );
	}

	/**
	 * @covers JD::v2Pace
	 */
	public function testV2Pace() {
		$this->assertEquals( "3:20", JD::v2Pace(300.75) );
	}

	/**
	 * @covers JD::Pace2v
	 */
	public function testPace2v() {
		$this->assertEquals( 300, JD::Pace2v(200) );
	}

	/**
	 * @covers JD::correctVDOT
	 */
	public function testCorrectVDOT() {
		// bootstrap.php will set corrector to 1
		$this->assertEquals( 50, JD::correctVDOT(50) );
	}

	/**
	 * @covers JD::Training2VDOT
	 */
	public function testTraining2VDOT() {
		// pulse_avg = 200 is HR_MAX
		$this->assertEquals( 40.2, JD::Training2VDOT(0, array(
			'sportid'	=> CONF_RUNNINGSPORT,
			'distance'	=> 10,
			's'			=> 50*60,
			'pulse_avg'	=> 200
		)), '', 0.1);
		$this->assertEquals( 52.3, JD::Training2VDOT(0, array(
			'sportid'	=> CONF_RUNNINGSPORT,
			'distance'	=> 10,
			's'			=> 40*60,
			'pulse_avg'	=> 200
		)), '', 0.1);
		$this->assertEquals( 61.1, JD::Training2VDOT(0, array(
			'sportid'	=> CONF_RUNNINGSPORT,
			'distance'	=> 10,
			's'			=> 35*60,
			'pulse_avg'	=> 200
		)), '', 0.1);
		$this->assertEquals( 73.3, JD::Training2VDOT(0, array(
			'sportid'	=> CONF_RUNNINGSPORT,
			'distance'	=> 10,
			's'			=> 30*60,
			'pulse_avg'	=> 200
		)), '', 0.1);
	}

	/**
	 * @covers JD::Training2points
	 * @covers JD::values2points
	 */
	public function testTraining2points() {
		// Expected values for 'key' %HRmax and 60 minutes
		$ExpectedValues = array(
			65	=> 6.0,
			66	=> 6.6,
			67	=> 7.3,
			68	=> 8.1,
			69	=> 9.0,
			70	=> 10.0,
			71	=> 11.0,
			72	=> 12.0,
			73	=> 13.0,
			74	=> 14.0,
			75	=> 15.0,
			76	=> 17.0,
			77	=> 18.0,
			78	=> 19.0,
			79	=> 20.0,
			80	=> 21.0,
			81	=> 22.0,
			82	=> 23.5,
			83	=> 25.0,
			84	=> 26.5,
			85	=> 28.0,
			86	=> 29.5,
			87	=> 31.0,
			88	=> 33.0,
			89	=> 35.0,
			90	=> 37.0,
			91	=> 39.0,
			92	=> 41.0,
			93	=> 43.4,
			94	=> 45.8,
			95	=> 48.0,
			96	=> 50.4,
			97	=> 53.0,
			98	=> 55.0,
			99	=> 57.7,
			100	=> 60.0
		);

		foreach ($ExpectedValues as $HR => $ExpectedValue) {
			$RealValue = JD::Training2points(0, array(
				's'			=> 60*60,
				'distance'	=> 0, // not used if pulse given
				'pulse_avg'	=> $HR*2, // to get %HFmax for HFmax = 200
				'arr_heart'	=> ''
			));
			//echo $HR.'%HFmax: '.$ExpectedValue.' = '.$RealValue.NL;

			$this->assertEquals( $ExpectedValue, $RealValue, 'JD::Training2points for '.$HR.'%HFmax differs too much: '.$RealValue.' instead of '.$ExpectedValue, $ExpectedValue*0.2 );
		}
	}

	/**
	 * @covers JD::CompetitionPrognosis
	 */
	public function testCompetitionPrognosis() {
		// VDOT: 32
		$this->assertEquals( 60*60 + 26, JD::CompetitionPrognosis(32, 10), '', 5 );
		$this->assertEquals( 133*60 + 49, JD::CompetitionPrognosis(32, 21.0975), '', 10 );
		$this->assertEquals( 274*60 + 59, JD::CompetitionPrognosis(32, 42.195), '', 20 );
		// VDOT: 48
		$this->assertEquals( 42*60 + 50, JD::CompetitionPrognosis(48, 10), '', 5 );
		$this->assertEquals( 94*60 + 53, JD::CompetitionPrognosis(48, 21.0975), '', 10 );
		$this->assertEquals( 197*60 + 27, JD::CompetitionPrognosis(48, 42.195), '', 20 );
		// VDOT: 60
		$this->assertEquals( 35*60 + 22, JD::CompetitionPrognosis(60, 10), '', 5 );
		$this->assertEquals( 78*60 + 9, JD::CompetitionPrognosis(60, 21.0975), '', 10 );
		$this->assertEquals( 163*60 + 25, JD::CompetitionPrognosis(60, 42.195), '', 20 );
	}

	/**
	 * @covers JD::calculateVDOTform
	 */
	public function testCalculateVDOTform() {
		// TODO
		$this->assertEquals( 0, JD::calculateVDOTform() );
	}

	/**
	 * @covers JD::correctionFactor
	 */
	public function testCorrectionFactor() {
		// TODO
		$this->assertEquals( 1, JD::correctionFactor() );
	}

	/**
	 * @covers JD::VDOTcorrectorFor
	 */
	public function testVDOTcorrectorFor() {
		$this->assertEquals( 1, JD::VDOTcorrectorFor(0, array('vdot' => 60, 'vdot_by_time' => 60)) );
		$this->assertEquals( 6/7, JD::VDOTcorrectorFor(0, array('vdot' => 70, 'vdot_by_time' => 60)) );
		$this->assertEquals( 6/8.5, JD::VDOTcorrectorFor(0, array('vdot' => 85, 'vdot_by_time' => 60)) );
	}

}

?>
